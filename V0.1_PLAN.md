# v0.1 Demo 版本详细规划

**项目**：自走棋 × 肉鸽爬塔策略游戏
**版本**：v0.1 核心循环验证版
**目标**：验证"布阵 → 选关 → 自动战斗 → 结算"核心循环的可玩性
**日期**：2026-02-23

---

## 1. 功能范围定义

### 1.1 核心功能（P0 - 必须交付）

#### 备战席系统
- 7×5 棋盘格子，支持棋子拖拽摆放/移除
- 左侧单位商店：展示可购买单位（5个），显示名称、稀有度、费用、定位
- 右侧属性面板：点击棋子显示详细属性（HP/AD/AP/ARM/MDF/SPD/ARG）
- 购买：从商店拖拽到棋盘，扣除金币；金币不足时提示
- 出售：选中棋子后点击出售按钮，返还80%金币，弹出确认对话框
- 升级：选中棋子后点击升级按钮，扣除金币，属性按倍率提升（上限2级）
- 顶部显示当前金币；城镇区域显示生命值

#### 关卡选择系统
- 每轮呈现2个选项卡片（简化版：普通挑战/困难挑战）
- 卡片显示：挑战类型、预期敌人描述、金币奖励
- 第5关固定为Boss战（无选择，直接进入）

#### 战斗系统
- 全自动战斗，无玩家操作
- 双方棋子按攻击速度间隔自动攻击
- 目标选择：攻击距离内最近的敌方单位
- 近战移动：向最近敌方直线移动，到达相邻格后开始攻击
- 远程攻击：原地攻击距离范围内目标
- 伤害计算：物理伤害 = AD × 100/(100+ARM)，魔法伤害 = 技能值 × 100/(100+MDF)
- 暴击判定：25%概率触发，伤害×125%
- HP归零则单位阵亡移出战场
- 胜负判定：一方全灭则另一方胜利

#### 结算系统
- 战斗结束后显示胜/败结果
- 胜利：获得金币奖励（普通+5/困难+10）+ 怪物掉落金币
- 失败：扣除1点生命值，不获得金币
- 返回备战席继续下一轮
- 生命值归零：显示游戏失败界面
- Boss通关：显示游戏胜利界面

#### 关卡流程
- 5波关卡，前4波2选1，第5波Boss
- 实现第1-5波全部敌方配置（普通+困难共9套阵容）
- 波次间返回备战席，可调整阵容

### 1.2 重要功能（P1 - 尽力交付）

#### 基础技能（实现3个）
- **撼地（战士）**：前方扇形物理AOE + 护甲击碎
- **蓄力一击（游侠）**：蓄力后直线穿透物理伤害
- **快速治疗（牧师）**：单体治疗 + 防御buff

#### 战斗体验增强
- 伤害飘字：物理伤害（白色）、魔法伤害（紫色）、治疗（绿色）、暴击（放大+橙色）
- 战斗变速：1× / 2× 切换按钮
- 单位血条显示
- 单位阵亡消失动画（简单淡出）

#### Boss特殊能力
- 赤鬃Boss实现"铁甲冲锋"（战斗8秒后直线伤害+击退）

### 1.3 延后功能（P2 - v0.2+）

- 全部9个玩家单位（v0.1只做5个）
- 全部技能实现
- Boss三阶段技能
- 随机事件系统
- 家族选择系统（v0.1固定狮子家）
- 3-5级升级
- 装备/道具系统
- 音效/BGM
- 指挥官技能
- 多层爬塔
- 主菜单/设置界面

---

## 2. v0.1 单位与数值

### 2.1 玩家单位（5个）

| 名称 | 定位 | 费用 | HP | AD | AP | ARM | MDF | SPD | ARG | 技能 |
|------|------|------|-----|-----|-----|------|------|------|------|------|
| 骑士 | 近战坦克 | 5 | 700 | 50 | 0% | 40 | 20 | 0.7 | 1 | 无（v0.1） |
| 战士 | 近战输出 | 5 | 600 | 80 | 0% | 20 | 20 | 0.6 | 1 | 撼地（P1） |
| 游侠 | 远程物理 | 5 | 400 | 55 | 10% | 20 | 20 | 0.6 | 6 | 蓄力一击（P1） |
| 法师 | 远程魔法 | 5 | 350 | 10 | 50% | 20 | 20 | 0.8 | 5 | 无（v0.1） |
| 牧师 | 远程治疗 | 20 | 400 | 10 | 20% | 20 | 30 | 0.7 | 5 | 快速治疗（P1） |

### 2.2 数值调整（已采纳）

| 调整项 | 原值 | ✅ 采纳值 | 理由 |
|--------|------|----------|------|
| 初始金币 | 10 | **15** | 开局能组3个单位，体验更饱满 |
| 升级上限 | 5级 | **2级** | 简化v0.1复杂度，避免数值崩盘 |
| 困难关金币 | +10 | **+15** | 拉大风险收益比，鼓励冒险 |
| 棋子上限 | 7 | **5** | v0.1只有5种单位，上限匹配 |

> ⚠️ **以上数值修改已于 2026-02-23 正式采纳，后续开发以此为准。**

---

## 3. 技术方案

### 3.1 技术栈选择

| 层面 | 选择 | 理由 |
|------|------|------|
| 游戏引擎 | **Godot 4** | 开源免费、轻量高效、GDScript 易上手、2D 支持优秀 |
| 语言 | **GDScript** (主) + C# (可选) | GDScript 与引擎深度集成，开发效率高 |
| 场景管理 | Godot 内置 SceneTree | 原生支持场景切换、节点树管理 |
| 状态管理 | 自定义 Autoload 单例 + 信号系统 | Godot 信号机制天然适合事件驱动架构 |
| 数据配置 | **JSON** 或 **Resource** 文件 | 单位/敌人/技能/关卡数据全部配置化 |
| 部署 | Web (HTML5) / Windows / macOS / Linux | Godot 一键导出多平台 |

### 3.2 架构设计（Godot 项目结构）

```
project/
├── autoload/                    # 全局单例（Autoload）
│   ├── GameState.gd             # 全局游戏状态（金币、生命、当前波次）
│   ├── BattleEngine.gd          # 战斗引擎（纯逻辑，无渲染依赖）
│   └── DataManager.gd           # 数据配置加载器
│
├── core/                        # 核心游戏逻辑
│   ├── Unit.gd                  # 单位基类（属性、升级、伤害计算）
│   ├── BattleAI.gd              # 目标选择、移动逻辑
│   ├── DamageCalc.gd            # 伤害公式（物理/魔法/暴击）
│   └── SkillSystem.gd           # 技能框架（P1）
│
├── scenes/                      # 游戏场景
│   ├── preparation/             # 备战席场景
│   │   ├── PreparationScene.tscn
│   │   └── PreparationScene.gd
│   ├── level_select/            # 关卡选择场景
│   │   ├── LevelSelectScene.tscn
│   │   └── LevelSelectScene.gd
│   ├── battle/                  # 战斗场景
│   │   ├── BattleScene.tscn
│   │   └── BattleScene.gd
│   ├── result/                  # 结算场景
│   │   ├── ResultScene.tscn
│   │   └── ResultScene.gd
│   └── game_over/               # 胜利/失败场景
│       ├── GameOverScene.tscn
│       └── GameOverScene.gd
│
├── ui/                          # UI 组件
│   ├── UnitShop.tscn            # 单位商店
│   ├── UnitInfoPanel.tscn       # 属性面板
│   ├── BoardGrid.tscn           # 棋盘格子
│   ├── HealthBar.tscn           # 血条组件
│   └── DamageText.tscn          # 伤害飘字（P1）
│
├── data/                        # 配置数据
│   ├── units.json               # 玩家单位属性表
│   ├── enemies.json             # 敌方单位属性表
│   ├── waves.json               # 波次配置（敌方阵容、奖励）
│   └── skills.json              # 技能配置（P1）
│
├── assets/                      # 静态资源
│   ├── sprites/                 # 单位精灵图
│   ├── ui/                      # UI 元素图片
│   └── effects/                 # 特效图片
│
└── project.godot                # Godot 项目配置
```

### 3.3 关键设计决策

**战斗逻辑与渲染分离**
- `BattleEngine.gd`（Autoload 单例）作为纯逻辑引擎，输入双方阵容，通过信号发射战斗事件（attack, damage, death, victory...）
- `BattleScene.gd` 连接信号，驱动节点动画播放
- 好处：可以先跑"headless"战斗验证数值，动画层后续叠加不影响核心逻辑
- Godot 的信号系统天然适合这种事件驱动架构

**简化版移动/寻路**
- v0.1 不做 A* 寻路，采用简单的"向目标直线移动"逻辑
- 近战：每个 tick 向最近敌人移动1格（曼哈顿距离），到达攻击距离后停止
- 远程：不移动，原地攻击范围内最近目标
- 碰撞：同格不允许重叠，先到先占
- 可使用 Godot 的 `TileMap` 或自定义 `GridMap` 管理棋盘格子

**状态机管理游戏流程**

```
[主菜单] → [备战席] → [关卡选择] → [战斗] → [结算] → [备战席]
                                                   ↓
                                              [游戏结束]
```

---

## 4. 里程碑规划

### M1：基础框架搭建（第1周）

**目标**：项目可运行，核心场景切换正常

- [ ] 初始化项目（Godot 4 项目 + 目录结构 + Autoload 配置）
- [ ] 实现场景管理器和场景切换（Preparation → LevelSelect → Battle → Result）
- [ ] 实现 GameState 全局状态（金币、生命值、当前波次）
- [ ] 加载并渲染 7×5 棋盘格子
- [ ] 实现基础 Unit 数据模型和 JSON 配置加载
- [ ] 占位符精灵图（简单的彩色方块或emoji）

**交付物**：可以在各场景间切换，棋盘格子可见

### M2：备战席系统（第2周）

**目标**：可以购买、摆放、升级、出售棋子

- [ ] 单位商店UI：展示5个可购买单位，显示名称/费用/稀有度
- [ ] 拖拽系统：从商店拖拽棋子到棋盘格子
- [ ] 购买逻辑：扣金币、生成棋子实例、放置到目标格
- [ ] 属性面板：点击棋子显示右侧属性详情
- [ ] 升级功能：花费金币升级到2级，属性按倍率变化
- [ ] 出售功能：返还80%金币，确认对话框
- [ ] 城镇区域：显示生命值
- [ ] "准备出征"按钮：跳转到关卡选择

**交付物**：可以完整操作备战席，买/卖/升级/摆放棋子

### M3：战斗系统核心（第3周）

**目标**：自动战斗跑通，能判定胜负

- [ ] Battle 引擎：输入双方阵容，输出事件流
- [ ] 伤害计算：物理伤害 + 护甲减免公式
- [ ] 暴击系统：25%概率 × 125%伤害
- [ ] 移动逻辑：近战向最近敌人移动，远程原地攻击
- [ ] 目标选择：攻击范围内最近敌方
- [ ] 死亡判定：HP≤0移除单位
- [ ] 胜负判定：一方全灭
- [ ] BattleScene 渲染：订阅事件流，驱动棋子动画（移动、攻击、受击、死亡）
- [ ] 血条 UI
- [ ] 战斗变速按钮（1× / 2×）

**交付物**：可以观看一场完整的自动战斗，看到单位移动、攻击、受伤、死亡

### M4：关卡流程与结算（第4周）

**目标**：完整的5波关卡流程可以从头打到尾

- [ ] 关卡选择界面：2张卡片（普通/困难），显示敌人/奖励预览
- [ ] 9套敌方阵容配置（5波 × 普通/困难 - 第5波只有Boss）
- [ ] 战斗结算面板：显示胜/败、金币奖励、当前生命值
- [ ] 金币结算逻辑：关卡奖励 + 怪物掉落
- [ ] 生命值扣减逻辑：失败-1 HP
- [ ] 波次递进：结算后回到备战席，波次+1
- [ ] Boss关强制进入（无选择）
- [ ] 游戏结束界面：胜利/失败 + 重新开始按钮

**交付物**：可以完整游玩一局（5波），体验从开局到通关/失败的全流程

### M5：打磨与P1功能（第5周）

**目标**：体验完善，加入P1功能

- [ ] 实现3个技能（撼地/蓄力一击/快速治疗）
- [ ] Boss特殊技能：铁甲冲锋
- [ ] 伤害飘字（颜色区分）
- [ ] 数值微调与测试（基于实际对战数据）
- [ ] 战斗结算MVP单位展示
- [ ] UI美化和交互细节打磨
- [ ] Bug修复与边缘情况处理
- [ ] 部署到可访问的URL

**交付物**：可对外展示的 v0.1 Demo

---

## 5. 风险评估与应对

### 高风险

| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| 战斗系统开发超出预期 | 拖延整体进度2周+ | 高 | M3先实现"headless battle"纯数值版，动画后补；战斗可以先用文字日志形式验证 |
| 数值不平衡导致体验差 | 玩家要么碾压要么被碾压 | 高 | 数据全配置化，支持热更新调数值；M4结束后安排1-2天专门测试数值 |
| 美术资源不足 | 视觉效果差影响演示质量 | 高 | 先用占位图/简单像素风/AI生成的可爱角色图；mockup已有风格参考（柴犬风格角色） |

### 中风险

| 风险 | 影响 | 概率 | 应对策略 |
|------|------|------|----------|
| 技能系统复杂度溢出 | M5无法完成3个技能 | 中 | 技能先实现最简版（只做伤害/治疗数值，不做完整的buff/debuff状态机） |
| Godot Web 导出体积 | HTML5 导出包较大（~30MB） | 低 | 可接受；优先 PC 原生版本，Web 版作为演示备选 |
| 拖拽交互在移动端体验差 | 移动端不可用 | 中 | v0.1优先PC浏览器；移动端适配放到v0.2 |

### 建议

1. **每个里程碑结束后做一次内部评审**，及时调整后续计划
2. **M3是关键里程碑**——战斗系统是游戏核心，如果M3延期，考虑砍掉M5的部分P1功能
3. **从M2开始就可以让策划介入测试数值**，不需要等战斗动画完成
4. **优先保证核心循环完整可玩**，而不是追求单个系统的完善度
5. **美术风格建议沿用mockup的可爱柴犬/猫咪风格**——辨识度高、门槛低、讨喜

---

## 6. 成功标准

v0.1 Demo 成功的判断依据：

- [ ] 新玩家能在**无引导情况下** 3 分钟内理解核心操作（买棋子、摆放、出征）
- [ ] 一局完整流程（5波）耗时 **15-25 分钟**
- [ ] 测试者在 Boss 战中**明显感受到压力**但通过合理布阵可以通关
- [ ] 至少有 **1 个"想再来一局"的瞬间**（困难关获得双倍金币、Boss险胜等）
- [ ] 无影响流程的 critical bug

---

*— v0.1 规划文档结束 —*
